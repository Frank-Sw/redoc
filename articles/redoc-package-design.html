<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>redoc Package Design • redoc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="redoc Package Design">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">redoc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://github.com/noamross/redoc/blob/master/.github/CONTRIBUTING.md">Contributing</a>
</li>
<li>
  <a href="../articles/redoc-package-design.html">Package Design</a>
</li>
<li>
  <a href="../news/index.html">Release Notes</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://github.com/noamross/redoc">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>redoc Package Design</h1>
                        <h4 class="author">Noam Ross</h4>
            
            <h4 class="date">2018-12-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/noamross/redoc/blob/master/vignettes/redoc-package-design.Rmd"><code>vignettes/redoc-package-design.Rmd</code></a></small>
      <div class="hidden name"><code>redoc-package-design.Rmd</code></div>

    </div>

    
    
<p>This document describes the general approach and design of <strong>redoc</strong> for developers interested in contributing.</p>
<p>Two-way R Markdown workflows are challenging because R Markdown and <strong>knitr</strong> workflows are lossy - the compiled document does not contain all of the information in the source. Also, we are limited by information that can be passed via <code>pandoc</code> from markdown to final formats and in reverse.</p>
<p>To produced a Reversible Reproducible Document in Word (a “redoc”), the <code><a href="../reference/rdocx_reversible.html">rdocx_reversible()</a></code> format first pre-parses the source <code>.Rmd</code> file. <strong>knitr</strong> doesn’t expose its parser to developers, so I’ve lifted most of the code for this parser from <strong>knitr</strong> and <strong>rmarkdown</strong>. The parser captures YAML headers, code chunks, and inline code, giving names to unnaamed chunks and inline code sections. These are stored in a data frame saved to <code>filename.chunks.csv</code>.</p>
<p><code><a href="../reference/rdocx_reversible.html">rdocx_reversible()</a></code> then knits the Rmd file, using <a href="https://yihui.name/knitr/hooks/">knitr hooks</a> to wrap all code chunks in <a href="http://pandoc.org/MANUAL.html#divs-and-spans">pandoc style <code>divs</code> and <code>spans</code></a>. This differentiates these outputs in the compiled markdown. These divs and spans are given an attribute of <code>custom-style="CHUNK_NAME"</code>. Non-included chunks are replaced with an empty raw <code>docx</code> element.</p>
<p>A final knitr document hook processes the whole document to translate Critic Markup syntax into appropriate Pandoc syntax.</p>
<p>Pandoc then converts the markdown to <code>docx</code>, and elements with <code>custom-style</code> attributes keep these attributes in the <code>docx</code> format, by using the <code>docx+styles</code> extension.</p>
<p><code>docx</code> files are just zip archives of XML files, so once the <code>docx</code> us created, A post-processor embeds three files for later retrieval: the original <code>*.Rmd</code>, the <code>*.chunks.csv</code> with chunk information, another version of the <code>.Rmd</code> which has been converted to <code>docx</code> and back. These files are available for retrieval when reversing the complilation. If <code>highlight_output=TRUE</code> is set, the post-processor also modifies all the output styles to be visible.</p>
<p>To reverse compilation via <code><a href="../reference/undoc.html">undoc()</a></code>, the <code>*.chunks.csv</code> file is first extracted, then pandoc is used to convert the <code>docx</code> back to markdown. A custom <a href="https://pandoc.org/lua-filters.html">lua filter</a> converts any track-changes text to <a href="http://criticmarkup.com/spec.php">Critic Markup</a>, and another lua filter replaces any elements with <code>custom-style="CHUNK_NAME"</code> attributes with placeholders of the form <code>[[chunk-name]]</code>. <code><a href="../reference/undoc.html">undoc()</a></code> then uses the data in <code>*.chunks.csv</code> to replace these placeholders with original chunk (or inline code). In the event that chunk output has been deleted, the chunk is placed immediately following the previous chunk (or at the top of the document). Deleted inline elements are not restored. The original YAML data is prepended to the document.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Noam Ross.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
